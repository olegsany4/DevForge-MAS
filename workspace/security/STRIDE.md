# DevForge-MAS — Базовая модель угроз (STRIDE)

> Версия: 1.0 • Дата: 2025-11-08 • Владелец: Security (Supervisor)

## Цели

- Зафиксировать первичную модель угроз по STRIDE.
- Дать основу для технических и процессных мер безопасности.
- Обеспечить воспроизводимость (линк на чек-листы и hardening).

## Контекст

Мультиагентная фабрика приложений DevForge-MAS: агенты, шина/очереди задач,
LLM-провайдеры, CI/CD, артефакты (ADR, контракты, тесты), external APIs.

---

## STRIDE

### S — Spoofing (Подмена)

- Подмена агента/сервиса в шине сообщений (fake worker, подмена webhook/WS endpoint).
- Компрометация токенов LLM/репозиториев/ботов и вход от имени другого участника.
- Неаутентифицированный доступ к API (нет HMAC/mTLS, слабые JWT без audience/exp).

#### Контрмеры — Spoofing

- mTLS/HMAC-подписи для внутренних вызовов; короткоживущие токены; PoLP и RBAC.
- Secret Manager/Vault, ротация, запрет секретов в git и логах.

### T — Tampering (Модификация)

- Изменение артефактов (промптов, контрактов JSON, ADR, тестов) в репозитории/артефакт-сторе.
- Supply-chain атаки (PyPI typosquatting, вредоносные wheels).
- Подмена данных в очередях/БД (инъекции в JSON/payloads).

#### Контрмеры — Tampering

- Подпись релизов/артефактов (sigstore/cosign), SBOM (syft).
- Pin+hash зависимостей, локальные mirrors, CI-проверки (`pip-audit`/`safety`).
- Валидация схем (JSON Schema), контент-санитайзеры.

### R — Repudiation (Отказ от авторства)

- Нет неизменяемых логов действий агентов/пользователей.
- Нет подписей релизных артефактов → спор происхождения.

#### Контрмеры — Repudiation

- Неизменяемые логи (WORM/S3 Object Lock), трассировка по request-id/job-id.
- Подписанные теги и релизы, журнал цепочки поставки.

### I — Information Disclosure (Разглашение)

- Утечка секретов (API-ключи) в git/логи/метрики.
- Prompt-инъекции, вытягивающие скрытые инструкции/ключи.
- Избыточные роли БД/облака (нарушение PoLP).

#### Контрмеры — Information Disclosure

- Секреты только в Secret Manager; маскирование в логах; DLP-фильтры.
- Разделение сред (dev/test/stage/prod) и учётных данных.

### D — Denial of Service (Отказ в обслуживании)

- Неограниченные запросы к LLM/API → исчерпание квот/бюджета.
- Тяжёлые пайплайны без лимитов; заполнение очередей/диска.

#### Контрмеры — Denial of Service

- Rate-limiters и квоты; circuit-breakers; backpressure/DLQ.
- Ротация логов, лимиты диска/объёма очередей.

### E — Elevation of Privilege (Повышение привилегий)

- Запуск пользовательских шаблонов/скриптов без изоляции (RCE).
- CI/CD с избыточными правами (write-token к prod-репо/реестрам).
- Инъекции в shell/SQL/OS при обработке внешних данных.

#### Контрмеры — Elevation of Privilege

- Контейнерная изоляция, read-only FS, seccomp/profiles.
- OIDC для CI → временные креды; минимальные роли.
- Обязательная валидация входов, запрет `eval/exec`.

## Ссылки на реализующие артефакты

- Чек-лист SAST/секретов → `workspace/security/SAST_CHECKLIST.md`
- Меры Hardening → `workspace/security/HARDENING.md`
- CI шаблон → `workspace/.ci/security.yml`
