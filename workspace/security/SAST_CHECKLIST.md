# DevForge-MAS — Чек-лист SAST/Secrets/Deps

> Версия: 1.0 • Дата: 2025-11-08 • Применимо к Python/Containers/CI

## Политика репозитория

- [ ] Protected-ветки main/master; запрещён прямой push
- [ ] Обязательные PR-review: ≥ 1 (рекоменд. 2)
- [ ] Мердж блокируется при провале CI-проверок безопасности
- [ ] Шаблоны PR требуют указать изменения безопасности (✅/N/A)

## Статический анализ (Python)

- [ ] `ruff check` — стиль/ошибки
- [ ] `mypy --strict` — типы (исключения небходимо документировать)
- [ ] `bandit -r src/ -lll` — поиск уязвимостей
- [ ] `semgrep ci --config p/ci --config p/python` — политические/инжекционные правила

## Секреты / токены

- [ ] `gitleaks detect` на PR/merge
- [ ] `detect-secrets scan` + baseline в репо
- [ ] Нет `.env` с реальными значениями в git; есть `.env.example` без секретов
- [ ] Маскирование секретов в логах CI и приложении

## Зависимости и цепочка поставки

- [ ] `pip-audit` / `safety check` без блокирующих уязвимостей
- [ ] Версии зафиксированы (pin) и, по возможности, hash-pin (pip-tools/uv)
- [ ] Включён internal PyPI proxy/mirror (если доступен)
- [ ] Генерация SBOM (`syft`) и публикация в артефакты
- [ ] Подпись релизных артефактов (`cosign`/`sigstore`)

## Контейнеры/IaC (если используются)

- [ ] `hadolint` для Dockerfile
- [ ] `trivy fs` и `trivy image` без критичных уязвимостей
- [ ] `checkov`/`terrascan` для IaC
- [ ] Минимальные базовые образы; user-nonroot

## LLM-специфика

- [ ] Входы/выходы LLM не содержат секретов/PII (мутаторы, маскировщики)
- [ ] Тесты на prompt-инъекции; system-prompt неизменяем
- [ ] Валидация JSON-контрактов ответов (JSON Schema)
- [ ] Предварительная оценка стоимости запроса (квоты/бюджеты)

## Логи и аудит

- [ ] Запрещён лог входов с секретами; PII — только в хэш/маске
- [ ] Трассировка по `request-id`/`job-id`
- [ ] Хранение аудита в неизменяемом сторе (WORM/S3 Lock)

## Выпускаемый артефакт PR

- [ ] Отчёты ruff/mypy/bandit/semgrep
- [ ] Отчёты gitleaks/detect-secrets
- [ ] Отчёты `pip-audit`/`safety` + список обновлений
- [ ] SBOM + подпись релизов (если релизный PR)
